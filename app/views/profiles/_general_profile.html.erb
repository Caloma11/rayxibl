<div class="generalProfile">

  <div class="profileBanner" style="background-image: url(<%= avatar_url(@profile) %>)">

  </div>
  <div class="profileHeader">
    <div class="profileHeaderRight">
      <h1><%= @profile.user.display_name %></h1>
      <p class="textGray"><%= @profile.profession %>, <%= @profile.location %></p>
    </div>
    <div class="profileHeaderLeft">
      <div class="flex items-center justify-content-center mt-3">
        <% @profile.average_rating.to_i.times do %>
          <%= image_tag "icons/colored-rating.svg", alt: "rating" %>
        <% end %>
        <% (5 - @profile.average_rating.to_i).times do %>
          <%= image_tag "icons/rating.svg", alt: "rating" %>
        <% end %>
        <span class="rating-size">(<%= @profile.ratings.size %>)</span>
      </div>
    </div>
  </div>

  <div class="profileButtons flex justify-content-around p-3 pt-0">
    <% if current_user.manager? %>
      <% if @connection %>
        <%#= link_to "Remove from your network", connection_path(current_user.find_connection(@profile.user)), class: "mr-3", method: :delete %>
        <%= link_to new_profile_booking_path(@profile), class: "mr-3", class: "btn-lg px-0 btn-primary" do %>
          <%= image_tag "icons/schedule.svg", alt: "Book user" %>
          <p class="textWhite">BOOK</p>
        <% end %>
      <% else %>
        <%= link_to profile_connections_path(@profile), class: "mr-3 btn-lg px-0 btn-primary", method: :post  do %>
          <%= image_tag "icons/user-plus.svg", alt: "Add user" %>
          <p class="textWhite">ADD</p>
        <% end %>
      <% end %>
      <div class="spacer">

      </div>
      <%= link_to "#", class: "btn-lg px-0 btn-white" do %>
        <%= image_tag "icons/message.svg", alt: "Messafe" %>
        <p>MESSAGE</p>
      <% end %>
  <% end %>

  </div>


  <div class="container">

    <div class="profileSection">
      <h3 class="textGray">Key kills</h3>
      <div class="flex justify-content-between">
        <% @profile.skill_list.each do |skill| %>
          <span><%= skill %></span>
        <% end %>
      </div>
    </div>

    <div class="profileSection">
      <h3>About</h3>
      <p><%= @profile.overview %></p>
    </div>

    <div class="profileSection">
      <h3>Experience Level</h3>
      <p><%= @profile.expertise&.capitalize %></p>
    </div>


    <h3>LINKS</h3>
    <% @profile.profile_attachments.includes(:attachment_attachment).each do |pa| %>
      <div class="profileSection">
        <% if pa.attachment.attached? %>
          <%= link_to "Download", download_attachment_path(pa), method: :post  %>
        <% else %>
          <%= link_to pa.title, sanitize_url(pa.url), target: :_blank, class: "btn btn-secondary"  %>
        <% end %>
      </div>
    <% end %>

    <% if @connection && current_user.manager? %>
      <div class="profileSection">
        <h3>Internal Notes</h3>
        <% @notes.each do |note| %>
          <div class="noteCard p-3 mb-3" style="border: 1px solid gray; border-radius: 4px;">
            <div class="noteCardHeader flex" style="border-bottom: 1px solid lightgray;">
              <div class="noteCardHeaderRight flex flex-grow-1">
                <% if note.manager.user.avatar.attached? %>
                  <%= image_tag note.manager.user.avatar, alt: "alttext", class: "profileAvatar rounded-circle", height: 32, width: 32  %>
                <% else %>
                  <%= image_tag "https://png.pngtree.com/png-clipart/20190520/original/pngtree-vector-users-icon-png-image_4144740.jpg", alt: "alttext", class: "profileAvatar rounded-circle", height: 32, width: 32 %>
                <% end %>
                <div class="ml-3">
                  <h2 class="my-0"><%= note.manager.user.display_name %></h2>
                  <p><%= note.created_at.strftime("%e %b %Y") %></p>
                </div>
              </div>
              <div class="noteCardHeaderLeft">
                <p class="my-0" style="transform: rotate(90deg); font-size: 32px">...</p>
              </div>
            </div>
            <div class="noteCardBody">
              <p><%= note.content %></p>
            </div>
          </div>
        <% end %>
      </div>

      <div id="writeYourNote">
        <h4>Write your note: <em style="color: gray">( Only visible to you )</em></h4>
        <%= simple_form_for [@profile, Note.new], remote: true do |f| %>
          <%= f.input :content, as: :text %>
          <%= f.submit %>
        <% end %>
      </div>
    <% end %>
  </div>
</div>
